{% extends "base.html" %}
{% block title %}{{ gallery.title }} — Photography{% endblock %}
{% block content %}

<!-- Hero Section -->
<section class="relative bg-black text-white py-20">
  <div class="container mx-auto px-6 text-center">
    <h1 class="text-5xl font-bold mb-4">{{ gallery.title }}</h1>
    {% if gallery.description %}
      <p class="max-w-2xl mx-auto text-gray-300">{{ gallery.description }}</p>
    {% endif %}
    {% if gallery.background_music %}
      <audio id="bg-music" src="{{ gallery.background_music.url }}" autoplay loop></audio>
      <button id="music-toggle" class="mt-6 bg-white text-black px-6 py-2 rounded-lg font-semibold hover:bg-gray-200 transition">
        ⏸ Pause Music
      </button>
    {% endif %}
  </div>
</section>

<!-- Image Gallery -->
<section class="bg-gray-50 dark:bg-black py-16">
  <div class="container mx-auto px-6">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for photo in photos %}
        <div class="overflow-hidden rounded-lg group relative">
          <a href="{{ photo.image.url }}" class="glightbox" data-gallery="gallery-{{ gallery.id }}" data-title="{{ photo.title|escape }}">
            <img data-src="{{ photo.image.url }}" alt="{{ photo.title|escape }}"
                 class="w-full h-96 object-cover transform group-hover:scale-110 transition duration-700 ease-in-out lazyload"
                 loading="lazy">
            <div class="absolute inset-0 bg-black bg-opacity-40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
              <h3 class="text-white text-lg font-semibold">{{ photo.title }}</h3>
            </div>
          </a>
        </div>
      {% empty %}
        <p class="text-center text-gray-400 col-span-full">No photos available in this gallery.</p>
      {% endfor %}
    </div>
  </div>
</section>

{# BEFORE / AFTER SLIDER: show only for photos that have a raw image #}
{% if photos %}
  <section class="py-12">
    <div class="container mx-auto px-6">
      <h3 class="text-2xl font-semibold mb-6">Before / After (Retouch)</h3>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-8">
        {% for photo in photos %}
          {% if photo.raw %}
            <div class="ba-slider-wrapper">
              <div class="ba-slider relative overflow-hidden rounded-lg" data-init="ba">
                <img class="w-full block" src="{{ photo.raw.url }}" alt="before {{ photo.title }}">
                <div class="ba-after absolute inset-0 overflow-hidden" style="width:50%;">
                  <img class="w-full block" src="{{ photo.image.url }}" alt="after {{ photo.title }}">
                </div>
                <div class="ba-handle absolute top-0 bottom-0 w-1 bg-white/80" style="left:50%; cursor:ew-resize;"></div>
              </div>
              <div class="flex justify-between mt-2 text-sm text-gray-500">
                <span>Before</span><span>After</span>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </section>
{% endif %}


<!-- <script>
document.addEventListener('DOMContentLoaded', function() {
  const music = document.getElementById('bg-music');
  const btn = document.getElementById('music-toggle');
  if (btn && music) {
    btn.addEventListener('click', function() {
      if (music.paused) {
        music.play();
        btn.textContent = '⏸ Pause Music';
      } else {
        music.pause();
        btn.textContent = '▶️ Play Music';
      }
    });
  }
});
</script> -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  // init any BA sliders
  document.querySelectorAll('[data-init="ba"]').forEach(function(container){
    const after = container.querySelector('.ba-after');
    const handle = container.querySelector('.ba-handle');
    if(!after || !handle) return;

    let dragging = false;

    const update = (clientX) => {
      const rect = container.getBoundingClientRect();
      let pct = (clientX - rect.left) / rect.width * 100;
      pct = Math.max(0, Math.min(100, pct));
      after.style.width = pct + '%';
      handle.style.left = pct + '%';
    };

    handle.addEventListener('mousedown', ()=> dragging = true);
    document.addEventListener('mouseup', ()=> dragging = false);
    document.addEventListener('mousemove', function(e){
      if(!dragging) return;
      update(e.clientX);
    });

    // touch support
    handle.addEventListener('touchstart', ()=> dragging = true);
    document.addEventListener('touchend', ()=> dragging = false);
    document.addEventListener('touchmove', function(e){
      if(!dragging) return;
      update(e.touches[0].clientX);
    });

    // click position support
    container.addEventListener('click', function(e){
      update(e.clientX);
    });
  });
});
</script>


{% endblock %}
